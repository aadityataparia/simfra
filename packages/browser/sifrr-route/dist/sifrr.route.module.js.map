{"version":3,"file":"sifrr.route.module.js","sources":["../src/regexpath.js","../src/sifrr.route.js"],"sourcesContent":["class RegexPath {\n  constructor(path, options = {}) {\n    this.options = Object.assign({ delimiter: '/' }, options);\n    this.path = path;\n  }\n\n  get regex() {\n    this._regex =\n      this._regex ||\n      new RegExp(\n        '^' +\n          this.path\n            .replace(/\\/:[A-Za-z0-9_]{0,}\\?/g, '(/[^/]{0,})?')\n            .replace(/\\*\\*/g, '(.{0,})')\n            .replace(/\\*/g, '([^/]{0,})')\n            .replace(/:[A-Za-z0-9_]{0,}/g, '([^/]{0,})') +\n          '$'\n      );\n    return this._regex;\n  }\n\n  get dataMap() {\n    if (this._dataMap) return this._dataMap;\n    this._dataMap = [];\n    this.path.split('/').forEach(r => {\n      if (r[0] === ':') {\n        this._dataMap.push(r);\n      } else if (r === '*' || r === '**' || r.match(/\\(.*\\)/)) {\n        this._dataMap.push(r);\n      }\n    });\n    return this._dataMap;\n  }\n\n  test(route) {\n    const data = {},\n      match = this.regex.exec(route);\n    if (match) {\n      this.dataMap.forEach((d, i) => {\n        if (d === '*') {\n          data['*'] = data['*'] || [];\n          data['*'].push(match[i + 1]);\n        } else if (d === '**') {\n          data['**'] = data['**'] || [];\n          data['**'].push(match[i + 1]);\n        } else if (d[0] === ':') {\n          data[d.substr(1)] = match[i + 1];\n        } else {\n          data.regexGroups = data.regexGroups || [];\n          data.regexGroups.push(match[i + 1]);\n        }\n      });\n    }\n    return {\n      match: !!match,\n      data: data\n    };\n  }\n}\n\nmodule.exports = RegexPath;\n","const SifrrDom = require('@sifrr/dom');\n\nconst Route = {\n  RegexPath: require('./regexpath')\n};\n\nconst firstTitle = window.document.title;\nclass SifrrRoute extends SifrrDom.Element {\n  static get template() {\n    return SifrrDom.template(\n      '<style>:host{display: none;}:host(.active){display: block;}</style><slot></slot>'\n    );\n  }\n\n  static observedAttrs() {\n    return ['path'];\n  }\n\n  onConnect() {\n    this.loaded = false;\n    this.constructor.all.add(this);\n  }\n\n  onDisconnect() {\n    this.constructor.all.delete(this);\n  }\n\n  onAttributeChange(attrName) {\n    if (attrName === 'path') {\n      this._routeRegex = new Route.RegexPath(this.getAttribute('path'));\n      this.refresh();\n    }\n  }\n\n  get routeRegex() {\n    return this._routeRegex;\n  }\n\n  refresh() {\n    const location = window.location.pathname;\n    const parsed = this.routeRegex.test(location);\n    if (parsed.match) {\n      this.activate();\n      this.state = parsed.data;\n      this.$$('[data-sifrr-route-state=true]', false).forEach(el => {\n        el.state = { route: parsed.data };\n      });\n    } else this.deactivate();\n  }\n\n  activate() {\n    if (!this.loaded) {\n      const sifrrElements = this.dataset.sifrrElements;\n      if (sifrrElements && sifrrElements.indexOf('-') > 0) {\n        try {\n          const elements = JSON.parse(sifrrElements);\n          this.loaded = Promise.all(Object.keys(elements).map(k => SifrrDom.load(k, elements[k])));\n        } catch (e) {\n          this.loaded = Promise.all(sifrrElements.split(',').map(k => SifrrDom.load(k)));\n        }\n      } else {\n        this.loaded = Promise.resolve(true);\n      }\n    }\n    this.classList.add('active');\n    this.onActivate();\n    SifrrDom.Event.trigger(this, 'activate');\n  }\n\n  onActivate() {}\n\n  deactivate() {\n    this.classList.remove('active');\n    this.onDeactivate();\n    SifrrDom.Event.trigger(this, 'deactivate');\n  }\n\n  onDeactivate() {}\n\n  static get currentUrl() {\n    return this._curl;\n  }\n\n  static set currentUrl(v) {\n    this._curl = v;\n  }\n\n  static refreshAll() {\n    if (window.location.pathname === this.currentUrl) return;\n    this.all.forEach(sfr => {\n      sfr.refresh();\n    });\n    this.onRouteChange();\n    this.currentUrl = window.location.pathname;\n  }\n\n  static onRouteChange() {}\n\n  static clickEventListener(e) {\n    if (!(window.history && window.history.pushState)) return false;\n    const target = e.composedPath ? e.composedPath()[0] : e.target; // composedPath works in safari too\n    if (\n      e.metaKey ||\n      e.ctrlKey ||\n      !target.matches('a') ||\n      target.host !== window.location.host ||\n      (target.target && target.target !== '_self')\n    )\n      return false;\n\n    e.preventDefault();\n    // replace title with First title if there's no attribute\n    const title = target.getAttribute('title') || firstTitle;\n    const state = {\n      pathname: target.pathname,\n      href: target.href,\n      title: title\n    };\n    window.document.title = title;\n    window.history.pushState(state, title, target.href);\n    SifrrRoute.refreshAll();\n\n    return true;\n  }\n\n  static popstateEventListener(e) {\n    if (e.state && e.state.title) window.document.title = e.state.title;\n    // replace title with First title if there's no state title\n    else window.document.title = firstTitle;\n    SifrrRoute.refreshAll();\n  }\n}\n\nSifrrRoute.all = new Set();\n\nSifrrDom.Event.add('activate');\nSifrrDom.Event.add('deactivate');\nRoute.Element = SifrrRoute;\nSifrrDom.register(SifrrRoute);\n\nwindow.addEventListener('popstate', SifrrRoute.popstateEventListener);\nwindow.document.addEventListener('click', SifrrRoute.clickEventListener);\n\nmodule.exports = Route;\n"],"names":["RegexPath","constructor","path","options","Object","assign","delimiter","regex","_regex","RegExp","replace","dataMap","_dataMap","split","forEach","r","push","match","test","route","data","exec","d","i","substr","regexGroups","Route","require$$0","firstTitle","window","document","title","SifrrRoute","SifrrDom","Element","template","observedAttrs","onConnect","loaded","all","add","onDisconnect","delete","onAttributeChange","attrName","_routeRegex","getAttribute","refresh","routeRegex","location","pathname","parsed","activate","state","$$","el","deactivate","sifrrElements","dataset","indexOf","elements","JSON","parse","Promise","keys","map","k","load","e","resolve","classList","onActivate","Event","trigger","remove","onDeactivate","currentUrl","_curl","v","refreshAll","sfr","onRouteChange","clickEventListener","history","pushState","target","composedPath","metaKey","ctrlKey","matches","host","preventDefault","href","popstateEventListener","Set","register","addEventListener"],"mappings":"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"}