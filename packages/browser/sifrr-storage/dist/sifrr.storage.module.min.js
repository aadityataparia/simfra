/*! Sifrr.Storage v0.0.5 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
const t=Object.prototype.toString,e=Math.random().toString(36).slice(-6);var r=class{static parse(t){let r=t;if("string"==typeof t){try{r=this.parse(JSON.parse(t))}catch(t){}if("string"==typeof r&&r.indexOf(e)>0){const[t,s]=r.split(e);r="ArrayBuffer"===t?new window.Uint8Array(s.split(",")).buffer:new window[t](s.split(","))}}else if(Array.isArray(t))r=[],t.forEach((t,e)=>{r[e]=this.parse(t)});else if("object"==typeof t){if(null===t)return null;r={};for(const e in t)r[e]=this.parse(t[e])}return r}static stringify(r){if("object"!=typeof r)return r;if(null===r)return null;let s;const i=t.call(r).slice(8,-1);switch(i){case"Object":s={};for(let t in r)s[t]=this.stringify(r[t]);s=JSON.stringify(s);break;case"ArrayBuffer":s=i+e+new window.Uint8Array(r).toString();break;default:s=i+e+r.toString()}return s}};const s={}.constructor;var i=class{constructor(t={}){this._options=t,this.name=this._options.name,this.version=this._options.version,this.tableName=this.name+this.version,this.description=this._options.description,this.type=this.constructor.type}_parseKeyValue(t,e){if(void 0===e){if(Array.isArray(t))return t;if("string"==typeof t)return[t];if(t.constructor===s)return t;throw Error("Invalid Key")}if("string"==typeof t){let r={};return r[t]=e,r}throw Error("Invalid Key")}_select(t){return this.all().then(e=>{let r={};return t.forEach(t=>r[t]=e[t]),r})}_upsert(t){let e=this.table;for(let r in t)e[r]=t[r];this.table=e}_delete(t){let e=this.table;t.forEach(t=>delete e[t]),this.table=e}_clear(){this.table={}}_isEqual(t,e){return this.tableName==t.name+t.version&&this.type==e}isSupported(t=!0){return!(!t||"undefined"!=typeof window&&"undefined"!=typeof document)||!(!window||void 0===this.store)}keys(){return this.all().then(t=>Object.keys(t))}all(){return Promise.resolve(this._parsedData())}get(t){return Promise.resolve(this._select(this._parseKeyValue(t)))}set(t,e){return Promise.resolve(this._upsert(this._parseKeyValue(t,e)))}del(t){return Promise.resolve(this._delete(this._parseKeyValue(t)))}clear(){return Promise.resolve(this._clear())}static stringify(t){return r.stringify(t)}static parse(t){return r.parse(t)}};var o=class extends i{constructor(t){super(t)}_parsedData(){return this._tx("readonly","getAllKeys").then(this._select.bind(this))}_select(t){const e={},r=[];return t.forEach(t=>r.push(this._tx("readonly","get",t).then(r=>e[t]=r))),Promise.all(r).then(()=>e)}_upsert(t){const e=[];for(let r in t)e.push(this._tx("readwrite","put",t[r],r));return Promise.all(e)}_delete(t){const e=[];return t.forEach(t=>e.push(this._tx("readwrite","delete",t))),Promise.all(e)}_clear(){return this._tx("readwrite","clear")}_tx(t,e,r,s){const i=this;return this._store=this._store||this.createStore(i.tableName),this._store.then(o=>new Promise((n,a)=>{const l=o.transaction(i.tableName,t).objectStore(i.tableName),c=l[e].call(l,r,s);c.onsuccess=t=>n(t.target.result),c.onerror=t=>a(t.error)}))}get store(){return window.indexedDB}createStore(t){return new Promise((e,r)=>{const s=this.store.open(t,1);s.onupgradeneeded=e=>{e.target.result.createObjectStore(t)},s.onsuccess=()=>e(s.result),s.onerror=()=>r(s.error)})}static get type(){return"indexeddb"}};var n=class extends i{constructor(t){super(t),this.createStore()}_parsedData(){const t=this;return new Promise(e=>{this.store.transaction(function(r){r.executeSql(`SELECT * FROM ${t.tableName}`,[],(r,s)=>{e(t.parse(s))})})})}_select(t){const e=t.map(()=>"?").join(", ");return this.execSql(`SELECT key, value FROM ${this.tableName} WHERE key in (${e})`,t)}_upsert(t){const e=this.tableName;this.store.transaction(r=>{for(let s in t)r.executeSql(`INSERT OR REPLACE INTO ${e}(key, value) VALUES (?, ?)`,[s,this.constructor.stringify(t[s])])})}_delete(t){const e=this.tableName,r=t.map(()=>"?").join(", ");return this.execSql(`DELETE FROM ${e} WHERE key in (${r})`,t)}_clear(){const t=this.tableName;return this.execSql(`DELETE FROM ${t}`)}get store(){return window.openDatabase("bs",1,this._options.description,this._options.size)}createStore(){const t=this.tableName;if(window&&"function"==typeof window.openDatabase)return this.execSql(`CREATE TABLE IF NOT EXISTS ${t} (key unique, value)`)}execSql(t,e=[]){const r=this;return new Promise(s=>{r.store.transaction(function(i){i.executeSql(t,e,(t,e)=>{s(r.parse(e))})})})}parse(t){const e={},r=t.rows.length;for(let s=0;s<r;s++)e[t.rows.item(s).key]=this.constructor.parse(t.rows.item(s).value);return e}static get type(){return"websql"}};var a=class extends i{constructor(t){super(t)}_parsedData(){return this.table}_select(t){const e={};return t.forEach(t=>{const r=this.constructor.parse(this.store.getItem(this.tableName+"/"+t));null!==r&&(e[t]=r)}),e}_upsert(t){for(let e in t)this.store.setItem(this.tableName+"/"+e,this.constructor.stringify(t[e]));return!0}_delete(t){return t.map(t=>this.store.removeItem(this.tableName+"/"+t))}_clear(){return Object.keys(this.store).forEach(t=>{0===t.indexOf(this.tableName)&&this.store.removeItem(t)}),!0}get table(){return this._select(Object.keys(this.store).map(t=>{if(0===t.indexOf(this.tableName))return t.slice(this.tableName.length+1)}).filter(t=>void 0!==t))}get store(){return window.localStorage}static get type(){return"localstorage"}};var l=class extends i{constructor(t){super(t)}_parsedData(){return this.table}get table(){let t=this.store,e={};return t.split("; ").forEach(t=>{let[r,s]=t.split("=");e[r]=this.constructor.parse(s)}),e[this.tableName]||{}}set table(t){document.cookie=`${this.tableName}=${i.stringify(t)}; path=/`}get store(){return document.cookie}static get type(){return"cookies"}};var c=class extends i{constructor(t,e={}){super(t),this.table=i.parse(e)}_parsedData(){return this.table}_upsert(t){for(let e in t)this.table[e]=t[e]}get store(){return this.table}static get type(){return"jsonstorage"}};let u={};u[o.type]=o,u[n.type]=n,u[a.type]=a,u[l.type]=l,u[c.type]=c;var h=u;class p{constructor(t){return t="string"==typeof t?{priority:[t]}:t||{},this._options=Object.assign(this.constructor.defaultOptions,t),this.storage}get storage(){let t=this.supportedStore();if(void 0===t)throw Error("No available storage supported in this browser");let e=this.constructor._matchingInstance(this._options,t.type);if(e)return e;{let e=new t(this._options);return this.constructor._add(e),e}}get priority(){return this._options.priority.concat(["indexeddb","websql","localstorage","cookies","jsonstorage"])}supportedStore(){for(let t=0;t<this.priority.length;t++){let e=this.constructor.availableStores[this.priority[t]];if(e&&new e(this._options).isSupported())return e}}static _matchingInstance(t,e){let r,s=this.all,i=s.length;for(r=0;r<i;r++)if(s[r]._isEqual(t,e))return s[r];return!1}static _add(t){this.all.push(t)}static get defaultOptions(){return{priority:[],name:"SifrrStorage",version:1,description:"Sifrr Storage",size:5242880}}static json(t){return new c({},t)}}p.availableStores=h,p.all=[];export default p;
/*! (c) @aadityataparia */
