/*! Sifrr.Fetch v0.0.5 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
this.Sifrr=this.Sifrr||{},this.Sifrr.Fetch=function(){"use strict";const e={}.constructor;var t=class{constructor(e,t){this._options=t,this._url=e}response(){const e=this;return window.fetch(this.url,this.options).then(t=>{const s=t.headers.get("content-type"),r=s&&s.includes("application/json");if(t.ok&&"function"==typeof e._options.onProgress){const s=t.headers.get("content-length"),r=parseInt(s,10);if(r&&t.body&&ReadableStream){const s=t.body.getReader();let o=0;t=new Response(new ReadableStream({start(t){const n=performance.now();return function i(){return s.read().then(({done:s,value:a})=>{if(!s)return o+=a.byteLength,e._options.onProgress({loaded:o,total:r,percent:o/r*100,speed:o/(performance.now()-n),value:a}),t.enqueue(a),i();t.close()})}()}}))}else e._options.onProgress({total:0,percent:100})}else if(!t.ok){"function"==typeof e._options.onProgress&&e._options.onProgress({percent:100});let s=Error(t.statusText);throw s.response=t,s}return{response:t,isJson:r}}).then(({response:e,isJson:t})=>t?e.json():e)}get url(){const e=this._options.params;return e&&Object.keys(e).length>0?this._url+"?"+Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"):this._url}get options(){const t=Object.assign({redirect:"follow"},this._options);return t.headers=this._options.headers||{},t.body&&t.body.constructor===e&&(t.headers["content-type"]=t.headers["content-type"]||"application/json",t.body=JSON.stringify(t.body)),t}};var s=class{constructor(e,t,s=(()=>Promise.reject(Error("No fallback provided for websocket failure.")))){this.url=e,this.protocol=t,this._fallback=!window.WebSocket,this.fallback=s,this.id=1,this._requests={},this._openSocket()}send(e,t="JSON"){const s={data:e,sifrrQueryType:t,sifrrQueryId:this.id++};return this.sendRaw(JSON.stringify(s),s.sifrrQueryId,e)}sendRaw(e,t,s=e){return this._fallback?this.fallback(s):this._openSocket().then(r=>(r.send(e),new Promise(e=>{this._requests[t]={res:s=>{delete this._requests[t],e(s)},original:s}}))).catch(e=>(window.console.error(e),this.fallback(s)))}_openSocket(){if(this.ws){if(this.ws.readyState===this.ws.OPEN)return Promise.resolve(this.ws);if(this.ws.readyState!==this.ws.CONNECTING)return this.ws=null,this._openSocket()}else this.ws=new window.WebSocket(this.url,this.protocol),this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this._onmessage.bind(this);const e=this;return new Promise((t,s)=>{window.requestAnimationFrame(function r(){e.ws.readyState===e.ws.CONNECTING?window.requestAnimationFrame(r):e.ws.readyState!==e.ws.OPEN?s(Error("Failed to open socket on ".concat(e.url))):t(e.ws)})})}onerror(){}onopen(){}onclose(){}close(){this.ws.close()}_onmessage(e){const t=JSON.parse(e.data);t.sifrrQueryId&&this._requests[t.sifrrQueryId].res(t.data),delete this._requests[t.sifrrQueryId],this.onmessage(e)}onmessage(){}};class r{static get(e,t){return this.request(e,t,"GET")}static post(e,t){return this.request(e,t,"POST")}static put(e,t){return this.request(e,t,"PUT")}static delete(e,t){return this.request(e,t,"DELETE")}static graphql(e,t){const{query:s,variables:r={}}=t;return delete t.query,delete t.variables,t.headers=t.headers||{},t.headers["Content-Type"]="application/json",t.headers.Accept="application/json",t.body={query:s,variables:r},this.request(e,t,"POST")}static socket(e,t,r){return new s(e,t,r)}static file(e,t={}){return t.headers=t.headers||{},t.headers.accept=t.headers.accept||"*/*",this.request(e,t)}static request(e,s={},r="GET"){let o=Promise.resolve({url:e,options:s,method:r});"function"==typeof s.before&&(o=o.then(s.before))&&delete s.before;let n="then";return"function"==typeof s.use&&(n="catch",o=o.then(({url:e,options:t,method:r})=>Promise.resolve(!0).then(()=>{const o=s.use({url:e,options:t,method:r});return delete s.use,o}).catch(s=>{throw window.console.error(s),{url:e,options:t,method:r}}))),o=o[n](({url:e,options:s,method:r})=>(s.method=r,new t(e,s).response())),"function"==typeof s.after&&(o=o.then(s.after))&&delete s.after,o}}return r._middlewares=[],r.WebSocket=s,r}();
/*! (c) @aadityataparia */
