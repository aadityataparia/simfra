/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const e=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);e.nextNonfilterNode=function(t){let e=this.currentNode;return e=t&&t(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},e.roll=function(t,e){let n=this.currentNode;for(;--t;)n=this.nextNonfilterNode(e);return n};class n{constructor(t,e){this.idx=t,this.ref=e}}var r={collect:function(t,n,r=!1){const o=[],i=n.length;e.currentNode=t;for(let t=0;t<i;t++)o.push(e.roll(n[t].idx,r));return o},create:function(t,r,o=!1){let i,s=[],a=0;for(e.currentNode=t;t;)(i=r(t,o))?(s.push(new n(a+1,i)),a=1):a++,t=e.nextNonfilterNode(o);return s},Ref:n};const o=window.document.createElement("template"),i=window.document.createElement("script");var s={TEMPLATE:()=>o.cloneNode(!1),SCRIPT:()=>i.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const{TEMPLATE:a}=s;var l=(t,...e)=>{const n=a();if("string"==typeof t);else{if(!t[0]||"string"!=typeof t[0])return t[0]?(Array.from(t).forEach(t=>{n.content.appendChild(t)}),n):t.nodeType&&!t.content?(n.content.appendChild(t),n):t;t=String.raw(t,...e)}return t=t.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=t,n};var c=function(t){const e=t._refs,n=t.stateMap,r=n.length;for(let o=0;o<r;o++){const r=n[o].ref,i=e[o];if(Array.isArray(r)){const e=r.length;for(let n=0;n<e;n++){const e=r[n];i.getAttribute(e.name)!==t.state[e.text]&&i.setAttribute(e.name,t.state[e.text]||"")}}else i.data!=t.state[r]&&(i.data=t.state[r]||"")}};const{ELEMENT_NODE:u}=s;var d=function(t){if(t.nodeType===u){const e=Array.prototype.slice.call(t.attributes),n=e.length,r=[];for(let o=0;o<n;o++){const n=e[o].value;"$"===n[0]&&(r.push({name:e[o].name,text:n.slice(2,-1)}),t.setAttribute(e[o].name,""))}return r.length>0?r:0}{let e=t.data;return"$"===e[0]?(t.data="",e.slice(2,-1)):0}};const{collect:h,create:f}=r;var m=function(t,e=null){if(!(t.nodeType||"string"==typeof t||t[0]&&t[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=l(t);if((t=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&-1!==t.getAttribute("is").indexOf("-"))return t;const r=f(t,d);function o(t){t.stateMap=r,t._refs=h(t,r),Object.defineProperty(t,"state",{get:()=>t._state,set:e=>{t._state=Object.assign(t._state||{},e),c(t)}})}return o(t),e&&(t.state=e),t.sifrrClone=function(e=!0,n){const r=t.cloneNode(e);return o(r),n?r.state=n:t.state&&(r.state=t.state),r},t};const{OUTER_REGEX:p}=s;function g(t){let e;e=t.indexOf("return ")>=0?t:"return "+t;try{return new Function(e)}catch(t){return window.console.log(`Error processing binding: \`${e}\``),""}}function E(t,e){try{return"string"==typeof t?t:t.call(e)}catch(n){const r=t.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,e),window.console.error(n)}}var w={getBindingFxns:t=>{const e=t.split(p),n=e.length,r=[];for(let t=0;t<n;t++)"$"===e[t][0]&&"{"===e[t][1]?r.push(g(e[t].slice(2,-1))):e[t]&&r.push(e[t]);return r},evaluateBindings:(t,e)=>1===t.length?E(t[0],e):t.map(t=>E(t,e)).join(""),evaluate:E,replacer:g};const{TEXT_NODE:y,COMMENT_NODE:b,ELEMENT_NODE:S,REPEAT_ATTR:v}=s,{getBindingFxns:_}=w;var T={creator:function(t,e){if(t.nodeType===y||t.nodeType===b){const e=t.data;if(e.indexOf("${")>-1)return{type:0,text:_(e.trim())}}else if(t.nodeType===S){const n={};if(e(t)){const e=t.innerHTML;e.indexOf("${")>=0&&(n.type=1,n.text=_(e.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else t.hasAttribute(v)&&(n.type=2,n.se=m(t.childNodes),n.text=_(t.getAttribute(v)),t.removeAttribute(v),t.textContent="");const r=t.attributes,o=r.length,i={events:{}};for(let t=0;t<o;t++){const e=r[t];"_"===e.name[0]?i.events[e.name]=_(e.value):e.value.indexOf("${")>=0&&(i[e.name]=_(e.value))}if(0===Object.keys(i.events).length&&delete i.events,Object.keys(i).length>0&&(n.attributes=i),Object.keys(n).length>0)return n}return 0}};const{collect:N,create:x}=r,{creator:A}=T,{ELEMENT_NODE:C,HTML_ATTR:O}=s;function M(t){return t.nodeType===C&&t.hasAttribute(O)}var $={collectRefs:(t,e)=>N(t,e,M),createStateMap:t=>x(t,A,M),twoWayBind:t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.hasAttribute("data-sifrr-bind")||null===e._root)return;const n=e.value||e.textContent;let r={};if(!e._root){let t;for(t=e;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}r[e.getAttribute("data-sifrr-bind")]=n,e._root&&(e._root.state=r)}},L=(t,e,n)=>{const r=t.getAttribute(e);!1===n||null==n?t.removeAttribute(e):r!==n&&("class"===e?t.className=n:t.setAttribute(e,n)),"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=n)};var R={shallowEqual:(t,e)=>{for(let n in t)if(!(n in e)||t[n]!==e[n])return!1;for(let n in e)if(!(n in t)||t[n]!==e[n])return!1;return!0}};const{shallowEqual:j}=R,{TEXT_NODE:q,COMMENT_NODE:k}=s;function P(t,e,n){const r=t.childNodes.length,o=e.length;if(0===o)return void(t.textContent="");if(0===r){let r;for(let i=0;i<o;i++)r=e[i],e[i].nodeType||(r=n(e[i])),t.appendChild(r);return}if(r>o){let e=r;for(;e>o;)t.removeChild(t.lastChild),e--}else if(r<o){let i,s=r;for(;s<o;)i=e[s],e[s].nodeType||(i=n(e[s])),t.appendChild(i),s++}const i=Math.min(o,r);for(let n,r=0,o=t.firstChild;r<i;r++)o=D(o,n=e[r]).nextSibling}function D(t,e){if(!e.nodeType)return j(t.state,e)||(t.state=e),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===q||t.nodeType===k)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);let n,r=t.attributes,o=e.attributes;for(let e=o.length-1;e>=0;--e)L(t,o[e].name,o[e].value);for(let o=r.length-1;o>=0;--o)n=r[o],e.hasAttribute(n.name)||t.removeAttribute(n.name);return P(t,Array.prototype.slice.call(e.childNodes)),t}var U={makeEqual:D,makeChildrenEqual:P};const{makeEqual:H}=U;function B(t,e){let n=[],r=[],o=-1,i=new Array(t.length);for(let s=e,a=t.length;s<a;s++){let e=t[s];if(e<0)continue;let a=F(n,e);-1!==a&&(i[s]=r[a]),a===o?(n[++o]=e,r[o]=s):e<n[a+1]&&(n[a+1]=e,r[a+1]=s)}for(let t=r[o];o>=0;t=i[t],o--)n[o]=t;return n}function F(t,e){let n=-1,r=t.length;if(r>0&&t[r-1]<=e)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);t[o]>e?r=o:n=o}return n}var W={makeChildrenEqualKeyed:function(t,e,n=(t=>t),r){const o=e.length;if(0===o)return void(t.textContent="");const i=t.childNodes.length;if(0===i){for(let r=0;r<o;r++)t.appendChild(n(e[r]));return}const s=[];let a=t.firstChild;for(;a;)s.push(a.state),a=a.nextSibling;let l,c,u,d=0,h=0,f=!0,m=i-1,p=o-1,g=t.firstChild,E=t.lastChild;t:for(;f;){for(f=!1,c=s[d],u=e[h];c[r]===u[r];){if(H(g,u),d++,g=g.nextSibling,h++,m<d||p<h)break t;c=s[d],u=e[h]}for(c=s[m],u=e[p];c[r]===u[r];){if(H(E,u),m--,l=E,E=E.previousSibling,p--,m<d||p<h)break t;c=s[m],u=e[p]}for(c=s[m],u=e[h];c[r]===u[r];){if(f=!0,H(E,u),a=E.previousSibling,t.insertBefore(E,g),E=a,h++,--m<d||p<h)break t;c=s[m],u=e[h]}for(c=s[d],u=e[p];c[r]===u[r];){if(f=!0,H(g,u),a=g.nextSibling,t.insertBefore(g,E.nextSibling),l=g,E=g.previousSibling,g=a,p--,m<++d||p<h)break t;c=s[d],u=e[p]}}if(p<h){if(d<=m){let e;for(;d<=m;)0===m?t.removeChild(E):(e=E.previousSibling,t.removeChild(E),E=e),m--}return}if(m<d){if(h<=p)for(;h<=p;)a=n(e[h]),t.insertBefore(a,E.nextSibling),E=a,h++;return}const w=new Array(p+1-h),y=new Map,b=[];for(let t=h;t<=p;t++)w[t]=-1,y.set(e[t][r],t);let S=0;for(let t=d;t<=m;t++)y.has(s[t][r])?(w[y.get(s[t][r])]=t,S++):b.push(t);if(0===S){for(let r=h;r<=p;r++)r>m?t.insertBefore(n(e[r]),g):(a=g.nextSibling,g.replaceWith(n(e[r])),g=a);if(p<m)for(;p<m;)a=E.previousSibling,t.removeChild(E),E=a,m--;return}const v=B(w,h),_=[];for(;d<=m;)_[d]=g,g=g.nextSibling,d++;let T,N=v.length-1;for(let r=p;r>=h;r--)v[N]===r?(l=_[w[r]],H(l,e[r]),N--):(-1===w[r]?T=n(e[r]):(T=_[w[r]],H(T,e[r])),t.insertBefore(T,l),l=T);for(let e=0;e<b.length;e++)t.removeChild(_[b[e]])},longestPositiveIncreasingSubsequence:B};const{makeChildrenEqual:I}=U,{makeChildrenEqualKeyed:X}=W,{evaluateBindings:K}=w,{TEMPLATE:G,KEY_ATTR:J}=s;var Y=function(t){if(!t._refs)return!1;const e=t._refs.length;for(let n=0;n<e;n++){const e=t.constructor.stateMap[n].ref,r=t._refs[n];if(e.attributes)for(let n in e.attributes)if("events"===n){for(let n in e.attributes.events){const o=K(e.attributes.events[n],t);r[n]=o}r._root=t,delete e.attributes.events}else{const o=K(e.attributes[n],t);L(r,n,o)}if(void 0===e.text)continue;const o=K(e.text,t);if(2===e.type){const t=r.getAttribute(J);t?X(r,o,t=>e.se.sifrrClone(!0,t),t):I(r,o,t=>e.se.sifrrClone(!0,t)),r.sifrrOldState=o}else if(1===e.type){let t;if(Array.isArray(o))t=o;else if(o.content&&11===o.content.nodeType)t=Array.prototype.slice.call(o.content.childNodes);else if(o.nodeType)t=[o];else if("string"==typeof o){const e=G();e.innerHTML=o.toString(),t=Array.prototype.slice.call(e.content.childNodes)}else t=Array.prototype.slice.call(o);I(r,t)}else r.data!=o&&(r.data=o)}t.onUpdate()};class z{constructor(e,n){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=n}get html(){if(this._html)return this._html;z.add(this.elementName,this);const e=this;return this._html=t.file(this.htmlUrl).then(t=>t.text()).then(t=>l(t).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(z.add(this.elementName,this),this._js=t.file(this.jsUrl).then(t=>t.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,t?this.js.then(t=>{new Function(t+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(t=>(window.console.error(t),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(e=>{if(e.src){const t=s.SCRIPT();t.src=e.src,t.type=e.type,window.document.body.appendChild(t)}else new Function(e.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:t.querySelector("template")})})}).catch(t=>{throw t})}static add(t,e){z._all[t]=e}static get all(){return z._all}}z._all={};var Z=z;const{makeChildrenEqual:Q}=U;var V=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(Z.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||$.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.stateMap,e=this.constructor.ctemp.content.cloneNode(!0);this._refs=$.collectRefs(e,t),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(e)):this.__content=e}}connectedCallback(){!this.constructor.useShadowRoot&&this.__content&&(Q(this,Array.prototype.slice.call(this.__content.childNodes)),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,n){"data-sifrr-state"===t&&(this.state=JSON.parse(n)),this.onAttributeChange(t,e,n)}onAttributeChange(){}get state(){return this._state}set state(t){this._state!==t&&Object.assign(this._state,t),this.update(),this.onStateChange()}onStateChange(){}update(){Y(this)}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t,e){const n=this.cloneNode(t);return n._state=e,n}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}}}(window.HTMLElement);const tt={},et={capture:!0,passive:!0},nt=(t,e)=>Promise.resolve((()=>{const n=t.composedPath?t.composedPath()[0]:t.target;let r=n;for(;r;){const o=r[`_${e}`]||(r.getAttribute?r.getAttribute(`_${e}`):null);"function"==typeof o?o.call(r._root||window,t,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),rt(t,e,r,n),r=r.parentNode||r.host}})()),rt=(t,e,n,r)=>{function o(e){e.forEach(e=>e(t,r,n))}for(let t in tt[e])("function"==typeof n.matches&&n.matches(t)||9===n.nodeType&&"document"===t)&&o(tt[e][t])};var ot={all:tt,add:t=>!tt[t]&&(window.addEventListener(t,e=>nt(e,t),et),tt[t]={},!0),addListener:(t,e,n)=>{const r=tt[t][e]||[];return r.indexOf(n)<0&&r.push(n),tt[t][e]=r,!0},removeListener:(t,e,n)=>{const r=tt[t][e]||[],o=r.indexOf(n);return o>=0&&r.splice(o,1),tt[t][e]=r,!0},trigger:(t,e,n)=>{"string"==typeof t&&(t=document.querySelector(t)),t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},n)))},opts:et,nativeToSyntheticEvent:nt};let it={elements:{},loadingElements:[]};return it.Element=V,it.Parser=$,it.Loader=Z,it.SimpleElement=m,it.Event=ot,it.makeEqual=U,it.template=l,it.register=((t,e)=>{t.useSR=it.config.useShadowRoot;const n=t.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,t,e),it.elements[n]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${n} - ${t.message}`,t.trace),!1}}),it.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,it.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),"string"!=typeof it.config.baseUrl)throw Error("baseUrl should be a string");it.Event.add("input"),it.Event.add("change"),it.Event.addListener("input","document",it.Parser.twoWayBind),it.Event.addListener("change","document",it.Parser.twoWayBind)},it.load=function(t,{url:e,js:n=!0}={}){if(window.customElements.get(t))return window.console.warn(`Error loading Element: ${t} - Custom Element with this name is already defined.`);let r=new it.Loader(t,e);const o=customElements.whenDefined(t);return it.loadingElements.push(o),r.executeScripts(n).then(()=>{window.customElements.get(t)||window.console.warn(`Executing '${t}' file didn't register the element. Ignore if you are registering element in a promise or async function.`)}).catch(t=>{it.loadingElements.splice(it.loadingElements.indexOf(o),1),window.console.error(t)})},it.loading=(()=>Promise.all(it.loadingElements)),it});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
