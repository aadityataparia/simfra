/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],e):((t=t||self).Sifrr=t.Sifrr||{},t.Sifrr.Dom=e(t.Sifrr.Fetch))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const e=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1);e.nextNonfilterNode=function(t){let e=this.currentNode;return e=t&&t(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()},e.roll=function(t,e){let r=this.currentNode;for(;--t;)r=this.nextNonfilterNode(e);return r};class r{constructor(t,e){this.idx=t,this.ref=e}}var n={collect:function(t,r,n=!1){const o=[],s=r.length;e.currentNode=t;for(let t=0;t<s;t++)o.push(e.roll(r[t].idx,n));return o},create:function(t,n,o=!1){let s,i=[],a=0;for(e.currentNode=t;t;)(s=n(t,o))?(i.push(new r(a+1,s)),a=1):a++,t=e.nextNonfilterNode(o);return i},Ref:r};const o=window.document.createElement("template"),s=window.document.createElement("script");var i={TEMPLATE:()=>o.cloneNode(!1),SCRIPT:()=>s.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g")};const{TEMPLATE:a}=i;var l=(t,...e)=>{const r=a();if("string"==typeof t);else{if(!t[0]||"string"!=typeof t[0])return t[0]?(Array.from(t).forEach(t=>{r.content.appendChild(t)}),r):t.nodeType&&!t.content?(r.content.appendChild(t),r):t;t=String.raw(t,...e)}return t=t.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),r.innerHTML=t,r},c=(t,e,r)=>{t.getAttribute(e)!==r&&("class"===e?t.className=r||"":t.setAttribute(e,r||"")),"value"!=e||"SELECT"!=t.nodeName&&"INPUT"!=t.nodeName||(t.value=r)};var d={shallowEqual:(t,e)=>{for(let r in t)if(!(r in e)||t[r]!==e[r])return!1;for(let r in e)if(!(r in t)||t[r]!==e[r])return!1;return!0}};const{shallowEqual:u}=d,{TEXT_NODE:h,COMMENT_NODE:f}=i;function p(t,e,r){const n=t.childNodes.length,o=e.length;if(0===o)return void(t.textContent="");if(0===n){let n;for(let s=0;s<o;s++)n=e[s],e[s].nodeType||(n=r(e[s])),t.appendChild(n);return}if(n>o){let e=n;for(;e>o;)t.removeChild(t.lastChild),e--}else if(n<o){let s,i=n;for(;i<o;)s=e[i],e[i].nodeType||(s=r(e[i])),t.appendChild(s),i++}const s=Math.min(o,n);for(let r,n=0,o=t.firstChild;n<s;n++)o=m(o,r=e[n]).nextSibling}function m(t,e){if(!e.nodeType)return u(t.state,e)||(t.state=e),t;if(t.nodeName!==e.nodeName)return t.replaceWith(e),e;if(t.nodeType===h||t.nodeType===f)return t.data!==e.data&&(t.data=e.data),t;e.state&&(t.state=e.state);let r,n=t.attributes,o=e.attributes;for(let e=o.length-1;e>=0;--e)c(t,o[e].name,o[e].value);for(let o=n.length-1;o>=0;--o)r=n[o],e.hasAttribute(r.name)||t.removeAttribute(r.name);return p(t,Array.prototype.slice.call(e.childNodes)),t}var g={makeEqual:m,makeChildrenEqual:p};const{makeEqual:E}=g;function y(t,e){let r=[],n=[],o=-1,s=new Array(t.length);for(let i=e,a=t.length;i<a;i++){let e=t[i];if(e<0)continue;let a=w(r,e);-1!==a&&(s[i]=n[a]),a===o?(r[++o]=e,n[o]=i):e<r[a+1]&&(r[a+1]=e,n[a+1]=i)}for(let t=n[o];o>=0;t=s[t],o--)r[o]=t;return r}function w(t,e){let r=-1,n=t.length;if(n>0&&t[n-1]<=e)return n-1;for(;n-r>1;){let o=Math.floor((r+n)/2);t[o]>e?n=o:r=o}return r}var _={makeChildrenEqualKeyed:function(t,e,r=(t=>t),n){const o=t.childNodes.length,s=e.length;if(0===s)return void(t.textContent="");if(0===o){for(let n=0;n<s;n++)t.appendChild(r(e[n]));return}const i=Array.prototype.slice.call(t.childNodes),a=i.map(t=>t.state);let l,c,d=0,u=0,h=!0,f=o-1,p=s-1,m=d,g=f;t:for(;h;){for(h=!1,l=a[d],c=e[u];l[n]===c[n];){if(E(i[d],c),u++,m++,f<++d||p<u)break t;l=a[d],c=e[u]}for(l=a[f],c=e[p];l[n]===c[n];){if(E(i[f],e[p]),p--,g--,--f<d||p<u)break t;l=a[f],c=e[p]}for(l=a[f],c=e[u];l[n]===c[n];){if(h=!0,E(i[f],c),t.insertBefore(i[g],i[m]),u++,--f<d||p<u)break t;l=a[f],c=e[u]}for(l=a[d],c=e[p];l[n]===c[n];){if(h=!0,E(i[d],c),t.insertBefore(i[m],i[g+1]),g--,m++,p--,f<++d||p<u)break t;l=a[d],c=e[p]}}if(p<u){if(d<=f)for(;d<=f;)t.removeChild(i[f]),f--;return}if(f<d){if(u<=p)for(;u<=p;)t.appendChild(r(e[u])),u++;return}const w=new Array(p+1-u),_=new Map;for(let t=u;t<=p;t++)w[t]=-1;for(let t=u;t<=p;t++)_.set(e[t][n],t);let v=0,b=[];for(let t=d;t<=f;t++)_.has(a[t][n])?(w[_.get(a[t][n])]=t,v++):b.push(t);if(0===v){for(let n=u;n<=p;n++)n>f?t.appendChild(r(e[n])):E(i[n],e[n]);if(p<f)for(;p<f;)t.removeChild(i[f]),f--;return}const S=y(w,u),N=[];let C=d;for(let t=d;t<=f;t++)N[t]=i[C],C++;for(let e=0;e<b.length;e++)t.removeChild(N[b[e]]);let T,x=S.length-1;f=i[f];for(let n=p;n>=u;n--)S[x]===n?(f=N[w[S[x]]],E(f,e[n]),x--):(-1===w[n]?T=r(e[n]):(T=N[w[n]],E(T,e[n])),t.insertBefore(T,f),f=T)},longestPositiveIncreasingSubsequence:y};const{OUTER_REGEX:v}=i;function b(t){let e;e=t.indexOf("return ")>=0?t:"return "+t;try{return new Function(e)}catch(t){return window.console.log(`Error processing binding: \`${e}\``),""}}function S(t,e){try{return"string"==typeof t?t:t.call(e)||""}catch(r){const n=t.toString();window.console.log(`Error evaluating: \`${n.slice(n.indexOf("{")+1,n.lastIndexOf("}"))}\` for element`,e),window.console.error(r)}}var N={getBindingFxns:t=>{const e=t.split(v),r=e.length,n=[];for(let t=0;t<r;t++)"$"===e[t][0]&&"{"===e[t][1]?n.push(b(e[t].slice(2,-1))):e[t]&&n.push(e[t]);return n},evaluateBindings:(t,e)=>1===t.length?S(t[0],e):t.map(t=>S(t,e)).join(""),evaluate:S,replacer:b};const{makeChildrenEqual:C}=g,{makeChildrenEqualKeyed:T}=_,{evaluateBindings:x}=N,A=i.TEMPLATE();var O={update:function(t){if(!t._refs)return!1;const e=t._refs.length;for(let r=0;r<e;r++){const e=t.constructor.stateMap[r].ref,n=t._refs[r];if(e.attributes)for(let r in e.attributes)if("events"===r){for(let r in e.attributes.events){const o=x(e.attributes.events[r],t);n[r]=o}n._root=t,delete e.attributes.events}else{const o=x(e.attributes[r],t);c(n,r,o)}if(void 0===e.text)continue;const o=x(e.text,t);if(2===e.type)n.dataset.sifrrKey?T(n,o,t=>e.se.sifrrClone(!0,t),n.dataset.sifrrKey):C(n,o,t=>e.se.sifrrClone(!0,t));else if(1===e.type){let t;Array.isArray(o)?t=o:o.content&&11===o.content.nodeType?t=Array.prototype.slice.call(o.content.childNodes):o.nodeType?t=[o]:"string"==typeof o?(A.innerHTML=o.toString(),t=Array.prototype.slice.call(A.content.childNodes)):t=Array.prototype.slice.call(o),0===t.length?n.textContent="":C(n,t)}else 0===e.type&&n.data!=o&&(n.data=o)}t.onUpdate()},simpleUpdate:function(t){const e=t._refs,r=t.stateMap,n=r.length;for(let o=0;o<n;o++){const n=r[o].ref,s=e[o];if(Array.isArray(n)){const e=n.length;for(let r=0;r<e;r++){const e=n[r];s.getAttribute(e.name)!==t.state[e.text]&&s.setAttribute(e.name,t.state[e.text]||"")}}else s.data!=t.state[n]&&(s.data=t.state[n]||"")}}};const{ELEMENT_NODE:M}=i;var $={simpleCreator:function(t){if(t.nodeType===M){const e=Array.prototype.slice.call(t.attributes),r=e.length,n=[];for(let o=0;o<r;o++){const r=e[o].value;"$"===r[0]&&(n.push({name:e[o].name,text:r.slice(2,-1)}),t.setAttribute(e[o].name,""))}return n.length>0?n:0}{let e=t.data;return"$"===e[0]?(t.data="",e.slice(2,-1)):0}}};const{collect:L,create:R}=n,{simpleUpdate:j}=O,{simpleCreator:q}=$;var k=function(t,e=null){if(!(t.nodeType||"string"==typeof t||t[0]&&t[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const r=l(t);if((t=r.content.firstElementChild||r.content.firstChild).isSifrr||-1!==t.nodeName.indexOf("-")||t.getAttribute&&t.getAttribute("is")&&-1!==t.getAttribute("is").indexOf("-"))return t;const n=R(t,q);function o(t){t.stateMap=n,t._refs=L(t,n),Object.defineProperty(t,"state",{get:()=>t._state,set:e=>{t._state=Object.assign(t._state||{},e),j(t)}})}return o(t),e&&(t.state=e),t.sifrrClone=function(e=!0,r){const n=t.cloneNode(e);return o(n),r?n.state=r:t.state&&(n.state=t.state),n},t};const{TEXT_NODE:U,COMMENT_NODE:P,ELEMENT_NODE:D}=i,{getBindingFxns:H}=N;var B={creator:function(t,e){if(t.nodeType===U||t.nodeType===P){const e=t.data;if(e.indexOf("${")>-1)return{type:0,text:H(e.trim())}}else if(t.nodeType===D){const r={};if(e(t)){const e=t.innerHTML;e.indexOf("${")>=0&&(r.type=1,r.text=H(e.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else(function(t){return t.dataset&&t.dataset.sifrrRepeat})(t)&&(r.type=2,r.se=k(t.childNodes),r.text=H(t.dataset.sifrrRepeat),t.removeAttribute("data-sifrr-repeat"));const n=t.attributes,o=n.length,s={events:{}};for(let t=0;t<o;t++){const e=n[t];"_"===e.name[0]?s.events[e.name]=H(e.value):e.value.indexOf("${")>=0&&(s[e.name]=H(e.value))}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(r.attributes=s),Object.keys(r).length>0)return r}return 0}};const{collect:F,create:W}=n,{creator:I}=B;function X(t){return t.dataset&&"true"==t.dataset.sifrrHtml}var K={collectRefs:(t,e)=>F(t,e,X),createStateMap:t=>W(t,I,X),twoWayBind:t=>{const e=t.composedPath?t.composedPath()[0]:t.target;if(!e.dataset.sifrrBind||null===e._root)return;const r=e.value||e.textContent;let n={};if(!e._root){let t;for(t=e;t&&!t.isSifrr;)t=t.parentNode||t.host;e._root=t||null}n[e.dataset.sifrrBind]=r,e._root&&(e._root.state=n)}};class G{constructor(e,r){if(!t)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=r}get html(){if(this._html)return this._html;G.add(this.elementName,this);const e=this;return this._html=t.file(this.htmlUrl).then(t=>t.text()).then(t=>l(t).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(G.add(this.elementName,this),this._js=t.file(this.jsUrl).then(t=>t.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(t){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,t?this.js.then(t=>{new Function(t+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(t=>(window.console.error(t),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(t=>{t.querySelectorAll("script").forEach(e=>{if(e.src){const t=i.SCRIPT();t.src=e.src,t.type=e.type,window.document.body.appendChild(t)}else new Function(e.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:t.querySelector("template")})})}).catch(t=>{throw t})}static add(t,e){G._all[t]=e}static get all(){return G._all}}G._all={};var J=G;const{update:z}=O,{makeChildrenEqual:Z}=g;var Q=function t(e){return class extends e{static extends(e){return t(e)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(J.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||K.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const t=this.constructor.stateMap,e=this.constructor.ctemp.content.cloneNode(!0);this._refs=K.collectRefs(e,t),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(e)):this.__content=e}}connectedCallback(){!this.constructor.useShadowRoot&&this.__content&&(Z(this,Array.prototype.slice.call(this.__content.childNodes)),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(t,e,r){"data-sifrr-state"===t&&(this.state=JSON.parse(r)),this.onAttributeChange(t,e,r)}onAttributeChange(){}get state(){return this._state}set state(t){this._state!==t&&Object.assign(this._state,t),this.update(),this.onStateChange()}onStateChange(){}update(){z(this)}onUpdate(){}isSifrr(t=null){return!t||t===this.constructor.elementName}sifrrClone(t,e){const r=this.cloneNode(t);return r._state=e,r}clearState(){this._state={},this.update()}$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelector(t):this.querySelector(t)}$$(t,e=!0){return this.constructor.useShadowRoot&&e?this.shadowRoot.querySelectorAll(t):this.querySelectorAll(t)}}}(window.HTMLElement);const V={},Y={capture:!0,passive:!0},tt=(t,e)=>Promise.resolve((()=>{const r=t.composedPath?t.composedPath()[0]:t.target;let n=r;for(;n;){const o=n[`_${e}`]||(n.getAttribute?n.getAttribute(`_${e}`):null);"function"==typeof o?o.call(n._root||window,t,r):"string"==typeof o&&new Function("event","target",o).call(n._root||window,event,r),et(t,e,n,r),n=n.parentNode||n.host}})()),et=(t,e,r,n)=>{function o(e){e.forEach(e=>e(t,n,r))}for(let t in V[e])("function"==typeof r.matches&&r.matches(t)||9===r.nodeType&&"document"===t)&&o(V[e][t])};var rt={all:V,add:t=>!V[t]&&(window.addEventListener(t,e=>tt(e,t),Y),V[t]={},!0),addListener:(t,e,r)=>{const n=V[t][e]||[];return n.indexOf(r)<0&&n.push(r),V[t][e]=n,!0},removeListener:(t,e,r)=>{const n=V[t][e]||[],o=n.indexOf(r);return o>=0&&n.splice(o,1),V[t][e]=n,!0},trigger:(t,e,r)=>{"string"==typeof t&&(t=document.querySelector(t)),t.dispatchEvent(new window.Event(e,Object.assign({bubbles:!0,composed:!0},r)))},opts:Y,nativeToSyntheticEvent:tt};let nt={elements:{},loadingElements:[]};return nt.Element=Q,nt.Parser=K,nt.Loader=J,nt.SimpleElement=k,nt.Event=rt,nt.makeEqual=g,nt.template=l,nt.register=((t,e)=>{t.useSR=nt.config.useShadowRoot;const r=t.elementName;if(!r)throw Error("Error creating Custom Element: No name given.",t);if(window.customElements.get(r))throw Error(`Error creating Element: ${r} - Custom Element with this name is already defined.`);if(r.indexOf("-")<1)throw Error(`Error creating Element: ${r} - Custom Element name must have one dash '-'`);try{return window.customElements.define(r,t,e),nt.elements[r]=t,!0}catch(t){return window.console.error(`Error creating Custom Element: ${r} - ${t.message}`,t.trace),!1}}),nt.setup=function(t){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,nt.config=Object.assign({baseUrl:"",useShadowRoot:!0},t),"string"!=typeof nt.config.baseUrl)throw Error("baseUrl should be a string");nt.Event.add("input"),nt.Event.add("change"),nt.Event.addListener("input","document",nt.Parser.twoWayBind),nt.Event.addListener("change","document",nt.Parser.twoWayBind)},nt.load=function(t,{url:e,js:r=!0}={}){if(window.customElements.get(t))return window.console.warn(`Error loading Element: ${t} - Custom Element with this name is already defined.`);let n=new nt.Loader(t,e);return nt.loadingElements.push(customElements.whenDefined(t)),n.executeScripts(r)},nt.loading=(()=>Promise.all(nt.loadingElements)),nt});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
