/*! Sifrr.Dom v0.0.2-alpha - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@sifrr/fetch")):"function"==typeof define&&define.amd?define(["@sifrr/fetch"],t):((e=e||self).Sifrr=e.Sifrr||{},e.Sifrr.Dom=t(e.Sifrr.Fetch))}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const t=window.document.createElement("template"),n=window.document.createElement("script");var r={TEMPLATE:()=>t.cloneNode(!1),SCRIPT:()=>n.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const o=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),{ELEMENT_NODE:i,HTML_ATTR:s}=r;function l(e){return e.nodeType===i&&e.hasAttribute(s)}o.nextNonfilterNode=function(e){if(e){let e=this.currentNode;return e=l(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()}return this.nextNode()},o.roll=function(e,t){let n=this.currentNode;for(;--e;)n=this.nextNonfilterNode(t);return n};class a{constructor(e,t){this.idx=e,this.ref=t}}var c={collect:function(e,t,n=!0){const r=[],i=t.length;o.currentNode=e;for(let e=0;e<i;e++)r.push(o.roll(t[e].idx,n));return r},create:function(e,t,n=!0){let r,i=[],s=0;for(o.currentNode=e;e;)(r=t(e,l,n))?(i.push(new a(s+1,r)),s=1):s++,e=o.nextNonfilterNode(n);return i},Ref:a};const{TEMPLATE:u}=r;var d=(e,...t)=>{const n=u();if("string"==typeof e);else{if(!e[0]||"string"!=typeof e[0])return e[0]?(Array.from(e).forEach(e=>{n.content.appendChild(e)}),n):e.nodeType&&!e.content?(n.content.appendChild(e),n):e;e=String.raw(e,...t)}return e=e.replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">").replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=e,n},h=(e,t,n)=>{const r=e.getAttribute(t);!1===n||null==n?e.removeAttribute(t):r!==n&&("class"===t?e.className=n:e.setAttribute(t,n)),"value"!=t||"SELECT"!=e.nodeName&&"INPUT"!=e.nodeName||(e.value=n)};var f={shallowEqual:(e,t)=>{for(let n in e)if(!(n in t)||e[n]!==t[n])return!1;for(let n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}};const{shallowEqual:m}=f,{TEXT_NODE:p,COMMENT_NODE:g}=r;function E(e,t,n){const r=e.childNodes.length,o=t.length;if(0===o)return void(e.textContent="");if(0===r){let r;for(let i=0;i<o;i++)r=t[i],t[i].nodeType||(r=n(t[i])),e.appendChild(r);return}if(r>o){let t=r;for(;t>o;)e.removeChild(e.lastChild),t--}else if(r<o){let i,s=r;for(;s<o;)i=t[s],t[s].nodeType||(i=n(t[s])),e.appendChild(i),s++}const i=Math.min(o,r);for(let n,r=0,o=e.firstChild;r<i;r++)o=w(o,n=t[r]).nextSibling}function w(e,t){if(!t.nodeType)return m(e.state,t)||(e.state=t),e;if(e.nodeName!==t.nodeName)return e.replaceWith(t),t;if(e.nodeType===p||e.nodeType===g)return e.data!==t.data&&(e.data=t.data),e;t.state&&(e.state=t.state);let n,r=e.attributes,o=t.attributes;for(let t=o.length-1;t>=0;--t)h(e,o[t].name,o[t].value);for(let o=r.length-1;o>=0;--o)n=r[o],t.hasAttribute(n.name)||e.removeAttribute(n.name);return E(e,Array.prototype.slice.call(t.childNodes)),e}var y={makeEqual:w,makeChildrenEqual:E};const{makeEqual:b}=y;function S(e,t){let n=[],r=[],o=-1,i=new Array(e.length);for(let s=t,l=e.length;s<l;s++){let t=e[s];if(t<0)continue;let l=v(n,t);-1!==l&&(i[s]=r[l]),l===o?(n[++o]=t,r[o]=s):t<n[l+1]&&(n[l+1]=t,r[l+1]=s)}for(let e=r[o];o>=0;e=i[e],o--)n[o]=e;return n}function v(e,t){let n=-1,r=e.length;if(r>0&&e[r-1]<=t)return r-1;for(;r-n>1;){let o=Math.floor((n+r)/2);e[o]>t?r=o:n=o}return n}var _={makeChildrenEqualKeyed:function(e,t,n=(e=>e),r){const o=t.length;if(0===o)return void(e.textContent="");const i=e.childNodes.length;if(0===i){for(let r=0;r<o;r++)e.appendChild(n(t[r]));return}const s=[];let l=e.firstChild;for(;l;)s.push(l.state),l=l.nextSibling;let a,c,u,d=0,h=0,f=!0,m=i-1,p=o-1,g=e.firstChild,E=e.lastChild;e:for(;f;){for(f=!1,c=s[d],u=t[h];c[r]===u[r];){if(b(g,u),d++,g=g.nextSibling,h++,m<d||p<h)break e;c=s[d],u=t[h]}for(c=s[m],u=t[p];c[r]===u[r];){if(b(E,u),m--,a=E,E=E.previousSibling,p--,m<d||p<h)break e;c=s[m],u=t[p]}for(c=s[m],u=t[h];c[r]===u[r];){if(f=!0,b(E,u),l=E.previousSibling,e.insertBefore(E,g),E=l,h++,--m<d||p<h)break e;c=s[m],u=t[h]}for(c=s[d],u=t[p];c[r]===u[r];){if(f=!0,b(g,u),l=g.nextSibling,e.insertBefore(g,E.nextSibling),a=g,E=g.previousSibling,g=l,p--,m<++d||p<h)break e;c=s[d],u=t[p]}}if(p<h){if(d<=m){let t;for(;d<=m;)0===m?e.removeChild(E):(t=E.previousSibling,e.removeChild(E),E=t),m--}return}if(m<d){if(h<=p)for(;h<=p;)l=n(t[h]),e.insertBefore(l,E.nextSibling),E=l,h++;return}const w=new Array(p+1-h),y=new Map,v=[];for(let e=h;e<=p;e++)w[e]=-1,y.set(t[e][r],e);let _=0;for(let e=d;e<=m;e++)y.has(s[e][r])?(w[y.get(s[e][r])]=e,_++):v.push(e);if(0===_){for(let r=h;r<=p;r++)r>m?e.insertBefore(n(t[r]),g):(l=g.nextSibling,g.replaceWith(n(t[r])),g=l);if(p<m)for(;p<m;)l=E.previousSibling,e.removeChild(E),E=l,m--;return}const T=S(w,h),N=[];for(;d<=m;)N[d]=g,g=g.nextSibling,d++;let x,C=T.length-1;for(let r=p;r>=h;r--)T[C]===r?(a=N[w[r]],b(a,t[r]),C--):(-1===w[r]?x=n(t[r]):(x=N[w[r]],b(x,t[r])),e.insertBefore(x,a),a=x);for(let t=0;t<v.length;t++)e.removeChild(N[v[t]])},longestPositiveIncreasingSubsequence:S};const{OUTER_REGEX:T}=r;function N(e){let t;t=e.indexOf("return ")>=0?e:"return "+e;try{return new Function(t)}catch(e){return window.console.log(`Error processing binding: \`${t}\``),""}}function x(e,t){try{return"string"==typeof e?e:e.call(t)}catch(n){const r=e.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,t),window.console.error(n)}}var C={getBindingFxns:e=>{const t=e.split(T),n=t.length,r=[];for(let e=0;e<n;e++)"$"===t[e][0]&&"{"===t[e][1]?r.push(N(t[e].slice(2,-1))):t[e]&&r.push(t[e]);return r},evaluateBindings:(e,t)=>1===e.length?x(e[0],t):e.map(e=>x(e,t)).join(""),evaluate:x,replacer:N};const{makeChildrenEqual:A}=y,{makeChildrenEqualKeyed:O}=_,{evaluateBindings:M}=C,{TEMPLATE:$,KEY_ATTR:R}=r;var L=function(e,t=e.constructor.stateMap){if(!e._refs)return!1;const n=e._refs.length;for(let r=0;r<n;r++){const n=t[r].ref,o=e._refs[r];if(n.attributes)for(let t in n.attributes)if("events"!==t){const r=M(n.attributes[t],e);h(o,t,r)}else{for(let t in n.attributes.events){const r=M(n.attributes.events[t],e);o[t]=r}o._root=e,delete n.attributes.events}if(void 0===n.text)continue;const i=M(n.text,e);if(0===n.type)o.data!=i&&(o.data=i);else if(2===n.type){const e=o.getAttribute(R);e?O(o,i,e=>n.se.sifrrClone(!0,e),e):A(o,i,e=>n.se.sifrrClone(!0,e)),o.sifrrOldState=i}else{let e;if(Array.isArray(i))e=i;else if(i.content&&11===i.content.nodeType)e=Array.prototype.slice.call(i.content.childNodes);else if(i.nodeType)e=[i];else if("string"==typeof i){const t=$();t.innerHTML=i.toString(),e=Array.prototype.slice.call(t.content.childNodes)}else e=Array.prototype.slice.call(i);A(o,e)}}};var j=function(e,t=null){if(!(e.nodeType||"string"==typeof e||e[0]&&e[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=d(e);if((e=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==e.nodeName.indexOf("-")||e.getAttribute&&e.getAttribute("is")&&-1!==e.getAttribute("is").indexOf("-"))return e;const r=K.createStateMap(e,!1);function o(e){e._refs=K.collectRefs(e,r,!1),Object.defineProperty(e,"state",{get:()=>e._state,set:t=>{e._state=Object.assign(e._state||{},t),L(e,r)}})}return o(e),t&&(e.state=t),e.sifrrClone=function(t=!0,n){const r=e.cloneNode(t);return o(r),n?r.state=n:e.state&&(r.state=e.state),r},e};const{getBindingFxns:q}=C;var k=(e,t,n)=>{e.type=2,e.se=j(t.childNodes),e.text=q(t.getAttribute(n)),t.textContent="",t.removeAttribute(n)};const{TEXT_NODE:P,COMMENT_NODE:D,ELEMENT_NODE:U,REPEAT_ATTR:H}=r,{getBindingFxns:B}=C;var F={creator:function(e,t,n){if(e.nodeType===P||e.nodeType===D){const t=e.data;if(t.indexOf("${")>-1)return{type:0,text:B(t.trim())}}else if(e.nodeType===U){const r={};if(n)if(t(e)){const t=e.innerHTML;t.indexOf("${")>=0&&(r.type=1,r.text=B(t.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else e.hasAttribute(H)&&k(r,e,H);const o=e.attributes,i=o.length,s={events:{}};for(let e=0;e<i;e++){const t=o[e];"_"===t.name[0]?s.events[t.name]=B(t.value):t.value.indexOf("${")>=0&&(s[t.name]=B(t.value))}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(r.attributes=s),Object.keys(r).length>0)return r}return 0}};const{collect:W,create:I}=c,{creator:X}=F;var K={collectRefs:W,createStateMap:(e,t)=>I(e,X,t),twoWayBind:e=>{const t=e.composedPath?e.composedPath()[0]:e.target;if(!t.hasAttribute("data-sifrr-bind")||null===t._root)return;const n=t.value||t.textContent;let r={};if(!t._root){let e;for(e=t;e&&!e.isSifrr;)e=e.parentNode||e.host;t._root=e||null}r[t.getAttribute("data-sifrr-bind")]=n,t._root&&(t._root.state=r)}};class G{constructor(t,n){if(!e)throw Error("Sifrr.Dom.load requires Sifrr.Fetch to work.");if(this.constructor.all[t])return this.constructor.all[t];this.elementName=t,this.url=n}get html(){if(this._html)return this._html;G.add(this.elementName,this);const t=this;return this._html=e.file(this.htmlUrl).then(e=>e.text()).then(e=>d(e).content).then(e=>(t.template=e.querySelector("template"),e)),this._html}get js(){return this._js?this._js:(G.add(this.elementName,this),this._js=e.file(this.jsUrl).then(e=>e.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(e){return this._executed?window.console.log(`'${this.elementName}' element's javascript was already executed`):(this._executed=!0,e?this.js.then(e=>{new Function(e+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(e=>(window.console.error(e),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts())}executeHTMLScripts(){return this.html.then(e=>{e.querySelectorAll("script").forEach(t=>{if(t.src){const e=r.SCRIPT();e.src=t.src,e.type=t.type,window.document.body.appendChild(e)}else new Function(t.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:e.querySelector("template")})})}).catch(e=>{throw e})}static add(e,t){G._all[e]=t}static get all(){return G._all}}G._all={};var J=G;const{makeChildrenEqual:Y}=y;var z=function e(t){return class extends t{static extends(t){return e(t)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(J.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp=this._ctemp||this.template,window.ShadyCSS&&this.useShadowRoot&&!this._ctemp.shady&&(window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this._ctemp.shady=!0),this._ctemp}static get stateMap(){return this._stateMap=this._stateMap||K.createStateMap(this.ctemp.content),this._stateMap}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this._state=Object.assign({},this.constructor.defaultState,this.state);const e=this.constructor.stateMap,t=this.constructor.ctemp.content.cloneNode(!0);this._refs=K.collectRefs(t,e),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t)):this.__content=t}}connectedCallback(){!this.constructor.useShadowRoot&&this.__content&&(Y(this,Array.prototype.slice.call(this.__content.childNodes)),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(e,t,n){"data-sifrr-state"===e&&(this.state=JSON.parse(n)),this.onAttributeChange(e,t,n)}onAttributeChange(){}get state(){return this._state}set state(e){this._state!==e&&Object.assign(this._state,e),this.update(),this.onStateChange()}onStateChange(){}update(){L(this)}onUpdate(){}isSifrr(e=null){return!e||e===this.constructor.elementName}sifrrClone(e,t){const n=this.cloneNode(e);return n._state=t,n}clearState(){this._state={},this.update()}$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelector(e):this.querySelector(e)}$$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelectorAll(e):this.querySelectorAll(e)}}}(window.HTMLElement);const Z={},Q={capture:!0,passive:!0},V=(e,t)=>Promise.resolve((()=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const o=r[`_${t}`]||(r.getAttribute?r.getAttribute(`_${t}`):null);"function"==typeof o?o.call(r._root||window,e,n):"string"==typeof o&&new Function("event","target",o).call(r._root||window,event,n),ee(e,t,r,n),r=r.parentNode||r.host}})()),ee=(e,t,n,r)=>{function o(t){t.forEach(t=>t(e,r,n))}for(let e in Z[t])("function"==typeof n.matches&&n.matches(e)||9===n.nodeType&&"document"===e)&&o(Z[t][e])};var te={all:Z,add:e=>!Z[e]&&(window.addEventListener(e,t=>V(t,e),Q),Z[e]={},!0),addListener:(e,t,n)=>{const r=Z[e][t]||[];return r.indexOf(n)<0&&r.push(n),Z[e][t]=r,!0},removeListener:(e,t,n)=>{const r=Z[e][t]||[],o=r.indexOf(n);return o>=0&&r.splice(o,1),Z[e][t]=r,!0},trigger:(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e)),e.dispatchEvent(new window.Event(t,Object.assign({bubbles:!0,composed:!0},n)))},opts:Q,nativeToSyntheticEvent:V};let ne={elements:{},loadingElements:[]};return ne.Element=z,ne.Parser=K,ne.Loader=J,ne.SimpleElement=j,ne.Event=te,ne.makeEqual=y,ne.template=d,ne.register=((e,t)=>{e.useSR=ne.config.useShadowRoot;const n=e.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",e);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,e,t),ne.elements[n]=e,!0}catch(e){return window.console.error(`Error creating Custom Element: ${n} - ${e.message}`,e.trace),!1}}),ne.setup=function(e){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,ne.config=Object.assign({baseUrl:"",useShadowRoot:!0},e),"string"!=typeof ne.config.baseUrl)throw Error("baseUrl should be a string");ne.Event.add("input"),ne.Event.add("change"),ne.Event.addListener("input","document",ne.Parser.twoWayBind),ne.Event.addListener("change","document",ne.Parser.twoWayBind)},ne.load=function(e,{url:t,js:n=!0}={}){if(window.customElements.get(e))return window.console.warn(`Error loading Element: ${e} - Custom Element with this name is already defined.`);let r=new ne.Loader(e,t);const o=customElements.whenDefined(e);return ne.loadingElements.push(o),r.executeScripts(n).then(()=>{window.customElements.get(e)||window.console.warn(`Executing '${e}' file didn't register the element. Ignore if you are registering element in a promise or async function.`)}).catch(e=>{ne.loadingElements.splice(ne.loadingElements.indexOf(o),1),window.console.error(e)})},ne.loading=(()=>Promise.all(ne.loadingElements)),ne});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
