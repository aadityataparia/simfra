/*! Sifrr.Dom v0.0.3 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).Sifrr=e.Sifrr||{},e.Sifrr.Dom=t())}(this,function(){"use strict";const e=window.document.createElement("template"),t=window.document.createElement("script");var n={TEMPLATE:()=>e.cloneNode(!1),SCRIPT:()=>t.cloneNode(!1),TEXT_NODE:3,COMMENT_NODE:8,ELEMENT_NODE:1,OUTER_REGEX:new RegExp("(\\${(?:(?:[^{}$]|{(?:[^{}$])*})*)})","g"),STATE_REGEX:/^\$\{this\.state\.([a-zA-Z0-9_$]+)\}$/,HTML_ATTR:"data-sifrr-html",REPEAT_ATTR:"data-sifrr-repeat",KEY_ATTR:"data-sifrr-key"};const r=window.document.createTreeWalker(window.document,window.NodeFilter.SHOW_ALL,null,!1),{HTML_ATTR:i,TEXT_NODE:o}=n;function s(e){return e.hasAttribute&&e.hasAttribute(i)}r.nextFilteredNode=function(){let e=this.currentNode;return e=s(e)?this.nextSibling()||(this.parentNode(),this.nextSibling()):this.nextNode()};var a={collect:function(e,t,n="nextFilteredNode"){const i=t.length,o=new Array(i);r.currentNode=e;for(let e,s=0;s<i;s++){for(e=t[s].idx;--e;)r[n]();o[s]=r.currentNode}return o},create:function(e,t,n){let i,a,l=[],c=0;for(r.currentNode=e;e;)e.nodeType===o&&""===e.data.trim()?(a=e,e=r.nextFilteredNode(e),a.remove()):((i=t(e,s,n))?(l.push({idx:c+1,ref:i}),c=1):c++,e=r.nextFilteredNode(e));return l}};const{TEMPLATE:l}=n;var c=(e,...t)=>{const n=l();if("string"==typeof e);else{if(!e[0]||"string"!=typeof e[0])return e[0]?(Array.from(e).forEach(e=>{n.content.appendChild(e)}),n):e.nodeType&&!e.content?(n.content.appendChild(e),n):e;e=String.raw(e,...t)}return e=e.replace(/(\\)?\$(\\)?\{/g,"${"),n.innerHTML=e,n},d=(e,t,n)=>{!1===n||null==n?e.hasAttribute(t)&&e.removeAttribute(t):"class"===t?e.className=n:"id"===t||"value"===t?e[t]=n:e.getAttribute(t)!==n&&e.setAttribute(t,n)};var u={shallowEqual:(e,t)=>{for(let n in e)if(!(n in t)||e[n]!==t[n])return!1;for(let n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}};const{shallowEqual:h}=u,{TEXT_NODE:f,COMMENT_NODE:m}=n;function p(e,t,n,r=!1){const i=t.length,o=e.childNodes.length;if(o>i){let t=o;for(;t>i;)e.removeChild(e.lastChild),t--}let s,a=e.firstChild,l=t[0];if(r)for(;l;)s=l.nextSibling,a?a=g(a,l).nextSibling:e.appendChild(l),l=s;else for(let r=0;r<i;r++)a?a=g(a,t[r]).nextSibling:(s=t[r],e.appendChild(s.nodeType?s:n(s)))}function g(e,t){if(!t.nodeType)return h(e._state,t)||e.setState(t),e;if(e.nodeName!==t.nodeName)return e.replaceWith(t),t;if(e.nodeType===f||e.nodeType===m)return e.data!==t.data&&(e.data=t.data),e;t.state&&e.setState(t.state);const n=e.attributes,r=t.attributes;for(let t=r.length-1;t>=0;--t)d(e,r[t].name,r[t].value);for(let r=n.length-1;r>=0;--r)t.hasAttribute(n[r].name)||e.removeAttribute(n[r].name);return p(e,t.childNodes,void 0,!0),e}var E={makeEqual:g,makeChildrenEqual:p};const{makeEqual:w}=E;function y(e,t){let n=[],r=[],i=-1,o=new Array(e.length);for(let s=t,a=e.length;s<a;s++){let t=e[s];if(t<0)continue;let a=b(n,t);-1!==a&&(o[s]=r[a]),a===i?(n[++i]=t,r[i]=s):t<n[a+1]&&(n[a+1]=t,r[a+1]=s)}for(let e=r[i];i>=0;e=o[e],i--)n[i]=e;return n}function b(e,t){let n=-1,r=e.length;if(r>0&&e[r-1]<=t)return r-1;for(;r-n>1;){let i=Math.floor((n+r)/2);e[i]>t?r=i:n=i}return n}var S={makeChildrenEqualKeyed:function(e,t,n,r){const i=t.length,o=e.childNodes.length;if(0===o){for(let r=0;r<i;r++)e.appendChild(n(t[r]));return}let s,a,l,c,d=0,u=0,h=!0,f=o-1,m=i-1,p=e.firstChild,g=e.lastChild;e:for(;h;){for(h=!1,a=p.state,l=t[u];a[r]===l[r];){if(w(p,l),d++,p=p.nextSibling,u++,f<d||m<u)break e;a=p.state,l=t[u]}for(a=g.state,l=t[m];a[r]===l[r];){if(w(g,l),f--,s=g,g=g.previousSibling,m--,f<d||m<u)break e;a=g.state,l=t[m]}for(a=g.state,l=t[u];a[r]===l[r];){if(h=!0,w(g,l),c=g.previousSibling,e.insertBefore(g,p),g=c,u++,--f<d||m<u)break e;a=g.state,l=t[u]}for(a=p.state,l=t[m];a[r]===l[r];){if(h=!0,w(p,l),c=p.nextSibling,e.insertBefore(p,g.nextSibling),s=p,g=p.previousSibling,p=c,m--,f<++d||m<u)break e;a=p.state,l=t[m]}}if(m<u){if(d<=f){let t;for(;d<=f;)0===f?e.removeChild(g):(t=g.previousSibling,e.removeChild(g),g=t),f--}return}if(f<d){if(u<=m)for(;u<=m;)c=n(t[u]),e.insertBefore(c,g.nextSibling),g=c,u++;return}const E=new Array(m+1-u),b=new Map,S=[],T=[];for(let e=u;e<=m;e++)E[e]=-1,b.set(t[e][r],e);let v=0;for(;d<=f;)b.has(p.state[r])?(E[b.get(p.state[r])]=d,v++):T.push(p),S[d]=p,p=p.nextSibling,d++;if(0===v){for(let r=u;r<=m;r++)e.insertBefore(n(t[r]),p);for(let t=0;t<T.length;t++)e.removeChild(T[t]);return}const x=y(E,u);let _,C=x.length-1;for(let r=m;r>=u;r--)x[C]===r?(s=S[E[r]],w(s,t[r]),C--):(-1===E[r]?_=n(t[r]):(_=S[E[r]],w(_,t[r])),e.insertBefore(_,s),s=_);for(let t=0;t<T.length;t++)e.removeChild(T[t])},longestPositiveIncreasingSubsequence:y};const{OUTER_REGEX:T,STATE_REGEX:v}=n;function x(e){let t;t=e.indexOf("return ")>=0?e:"return "+e;try{return new Function(t)}catch(e){return window.console.log(`Error processing binding: \`${t}\``),""}}function _(e,t){try{return"string"==typeof e?e:e.call(t)}catch(n){const r=e.toString();window.console.log(`Error evaluating: \`${r.slice(r.indexOf("{")+1,r.lastIndexOf("}"))}\` for element`,t),window.console.error(n)}}const C={getBindingFxns:e=>{const t=e.split(T),n=t.length,r=[];for(let e=0;e<n;e++)"$"===t[e][0]&&"{"===t[e][1]?r.push(x(t[e].slice(2,-1))):t[e]&&r.push(t[e]);return 1===r.length?r[0]:r},getStringBindingFxn:e=>{const t=e.match(v);return t?t[1]:C.getBindingFxns(e)},evaluateBindings:(e,t)=>"function"==typeof e?_(e,t):e.map(e=>_(e,t)).join(""),evaluate:_,replacer:x};var N=C;const{makeChildrenEqual:A}=E,{makeChildrenEqualKeyed:O}=S,{evaluateBindings:$}=N,{TEMPLATE:R,KEY_ATTR:L}=n;var M=function(e,t){if(!e._refs)return!1;let n,r,i;t=t||e.constructor.stateMap;const o=e._refs.length;for(let s=0;s<o;s++)if(n=t[s].ref,r=e._refs[s],0!==n.type)if(1!==n.type){if(n.attributes)for(let t in n.attributes)if("events"!==t)i=0===n.attributes[t].type?e.state[n.attributes[t].text]:$(n.attributes[t].text,e),d(r,t,i);else if(!r._sifrrEventSet){for(let t in n.attributes.events)r[t]=$(n.attributes.events[t],e);r._root=e,r._sifrrEventSet=!0}if(void 0!==n.text)if((i=$(n.text,e))&&0!==i.length||(r.textContent=""),3===n.type){let e;n.keyed&&(e=r.getAttribute(L))?O(r,i,n.se.sifrrClone.bind(n.se),e):A(r,i,n.se.sifrrClone.bind(n.se))}else{let e,t=!1;if(Array.isArray(i))e=i;else if(i.content&&11===i.content.nodeType)e=i.content.childNodes,t=!0;else if(i.nodeType)e=[i];else if("string"==typeof i){const n=R();n.innerHTML=i.toString(),e=n.content.childNodes,t=!0}else e=Array.prototype.slice.call(i);A(r,e,void 0,t)}}else i=$(n.text,e),r.data!=i&&(r.data=i);else i=e.state[n.text],r.data!=i&&(r.data=i)};const{collect:k,create:q}=a;var j=function(e,t=null){if(!(e.nodeType||"string"==typeof e||e[0]&&e[0].nodeType))throw TypeError("First argument for SimpleElement should be of type string or DOM element");const n=c(e);if((e=n.content.firstElementChild||n.content.firstChild).isSifrr||-1!==e.nodeName.indexOf("-")||e.getAttribute&&e.getAttribute("is")&&-1!==e.getAttribute("is").indexOf("-"))return e.isSifrr||(window.document.body.appendChild(e),window.document.body.removeChild(e)),e;const r=q(e,W,t);function i(e){Object.assign(this.state,e),M(this,r)}return e.sifrrClone=function(n){const o=e.cloneNode(!0);return o._refs=k(o,r,"nextNode"),o.state=Object.assign({},t,n),o.setState=i,M(o,r),o},e};const{getBindingFxns:D}=N,{KEY_ATTR:F}=n;var U=(e,t,n)=>{let r;e.type=3,t.hasAttribute("data-sifrr-default-state")&&(r=JSON.parse(t.getAttribute("data-sifrr-default-state"))),e.se=j(t.childNodes,r),e.text=D(t.getAttribute(n)),e.keyed=t.hasAttribute(F),t.textContent="",t.removeAttribute(n)};const{TEXT_NODE:B,COMMENT_NODE:P,ELEMENT_NODE:H,REPEAT_ATTR:X}=n,{getBindingFxns:K,getStringBindingFxn:I}=N;var W=function(e,t,n){if(e.nodeType===B||e.nodeType===P){const t=e.data;if(t.indexOf("${")>-1){const r=I(t.trim());return"string"!=typeof r?{type:1,text:r}:(n&&(e.data=n[r]),{type:0,text:r})}}else if(e.nodeType===H){const r={};if(t(e)){const t=e.innerHTML;t.indexOf("${")>=0&&(r.type=2,r.text=K(t.replace(/<!--((?:(?!-->).)+)-->/g,"$1").trim()))}else e.hasAttribute(X)&&U(r,e,X);const i=e.attributes,o=i.length,s={events:{}};for(let t=0;t<o;t++){const r=i[t];if("_"===r.name[0])s.events[r.name]=K(r.value);else if(r.value.indexOf("${")>=0){const t=I(r.value);"string"!=typeof t?s[r.name]={type:1,text:t}:(s[r.name]={type:0,text:t},n&&d(e,r.name,n[t]))}}if(0===Object.keys(s.events).length&&delete s.events,Object.keys(s).length>0&&(r.attributes=s),Object.keys(r).length>0)return r}return 0};class G{constructor(e,t){if(!window.fetch)throw Error("Sifrr.Dom.load requires Fetch API to work.");if(this.constructor.all[e])return this.constructor.all[e];this.elementName=e,this.url=t}get html(){if(this._html)return this._html;G.add(this.elementName,this);const e=this;return this._html=window.fetch(this.htmlUrl).then(e=>e.text()).then(e=>c(e).content).then(t=>(e.template=t.querySelector("template"),t)),this._html}get js(){return this._js?this._js:(G.add(this.elementName,this),this._js=window.fetch(this.jsUrl).then(e=>e.text()),this._js)}get htmlUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.html`}get jsUrl(){return this.url||`${window.Sifrr.Dom.config.baseUrl+"/"}elements/${this.elementName.split("-").join("/")}.js`}executeScripts(e){if(this._executed)throw Error(`'${this.elementName}' element's javascript was already executed`);return this._executed=!0,e?this.js.then(e=>{new Function(e+`\n //# sourceURL=${this.jsUrl}`).call()}).catch(e=>(window.console.error(e),window.console.log(`JS file for '${this.elementName}' gave error. Trying to get html file.`),this.executeHTMLScripts())):this.executeHTMLScripts()}executeHTMLScripts(){return this.html.then(e=>{e.querySelectorAll("script").forEach(t=>{if(t.src){const e=n.SCRIPT();e.src=t.src,e.type=t.type,window.document.body.appendChild(e)}else new Function(t.text+`\n //# sourceURL=${this.htmlUrl}`).call({currentTempate:e.querySelector("template")})})})}static add(e,t){G._all[e]=t}static get all(){return G._all}}G._all={};var J=G;const{collect:Y,create:z}=a;var Z=function e(t){return class extends t{static extends(t){return e(t)}static get observedAttributes(){return["data-sifrr-state"].concat(this.observedAttrs())}static observedAttrs(){return[]}static get template(){return(J.all[this.elementName]||{template:!1}).template}static get ctemp(){return this._ctemp?this._ctemp:(this._ctemp=this.template,this._ctemp&&(this.useShadowRoot&&window.ShadyCSS&&!window.ShadyCSS.nativeShadow&&window.ShadyCSS.prepareTemplate(this._ctemp,this.elementName),this.stateMap=z(this._ctemp.content,W,this.defaultState)),this._ctemp)}static get elementName(){return this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}static get useShadowRoot(){return this.useSR}constructor(){if(super(),this.constructor.ctemp){this.state=Object.assign({},this.constructor.defaultState,this.state);const e=this.constructor.ctemp.content.cloneNode(!0);this._refs=Y(e,this.constructor.stateMap),this.constructor.useShadowRoot?(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(e)):this.__content=e}}connectedCallback(){this.__content&&(this.textContent="",this.appendChild(this.__content),delete this.__content),this.hasAttribute("data-sifrr-state")||this.update(),this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect()}onDisconnect(){}attributeChangedCallback(e,t,n){"data-sifrr-state"===e&&this.setState(JSON.parse(n)),this.onAttributeChange(e,t,n)}onAttributeChange(){}setState(e){this.state!==e&&Object.assign(this.state,e),this.update(),this.onStateChange()}onStateChange(){}update(){M(this),this.onUpdate()}onUpdate(){}isSifrr(e=null){return!e||e===this.constructor.elementName}sifrrClone(e){const t=this.cloneNode(!1);return t.state=e,t}clearState(){this.state={},this.update()}$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelector(e):this.querySelector(e)}$$(e,t=!0){return this.constructor.useShadowRoot&&t?this.shadowRoot.querySelectorAll(e):this.querySelectorAll(e)}}}(window.HTMLElement);const Q={},V={capture:!0,passive:!0},ee=(e,t)=>{const n=e.composedPath?e.composedPath()[0]:e.target;let r=n;for(;r;){const i=r[`_${t}`]||(r.hasAttribute?r.getAttribute(`_${t}`):null);"function"==typeof i?i.call(r._root||window,e,n):"string"==typeof i&&new Function("event","target",i).call(r._root||window,event,n),te(e,t,r,n),r=r.parentNode||r.host}},te=(e,t,n,r)=>{function i(t){t.forEach(t=>t(e,r,n))}Promise.resolve((()=>{for(let e in Q[t])("function"==typeof n.matches&&n.matches(e)||9===n.nodeType&&"document"===e)&&i(Q[t][e])})())};var ne={all:Q,add:e=>!Q[e]&&(window.addEventListener(e,t=>ee(t,e),V),Q[e]={},!0),addListener:(e,t,n)=>{const r=Q[e][t]||[];return r.indexOf(n)<0&&r.push(n),Q[e][t]=r,!0},removeListener:(e,t,n)=>{const r=Q[e][t]||[],i=r.indexOf(n);return i>=0&&r.splice(i,1),Q[e][t]=r,!0},trigger:(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e)),e.dispatchEvent(new window.Event(t,Object.assign({bubbles:!0,composed:!0},n)))},opts:V,nativeToSyntheticEvent:ee};let re={elements:{},loadingElements:[]};return re.Element=Z,re.twoWayBind=(e=>{const t=e.composedPath?e.composedPath()[0]:e.target;if(!t.hasAttribute("data-sifrr-bind")||null===t._root)return;const n=t.value||t.textContent;if(!t._root){let e;for(e=t;e&&!e.isSifrr;)e=e.parentNode||e.host;t._root=e||null}t._root&&t._root.setState({[t.getAttribute("data-sifrr-bind")]:n})}),re.Loader=J,re.SimpleElement=j,re.Event=ne,re.makeChildrenEqual=E.makeChildrenEqual,re.makeChildrenEqualKeyed=S.makeChildrenEqualKeyed,re.makeEqual=E.makeEqual,re.template=c,re.register=((e,t)=>{e.useSR=re.config.useShadowRoot;const n=e.elementName;if(!n)throw Error("Error creating Custom Element: No name given.",e);if(window.customElements.get(n))throw Error(`Error creating Element: ${n} - Custom Element with this name is already defined.`);if(n.indexOf("-")<1)throw Error(`Error creating Element: ${n} - Custom Element name must have one dash '-'`);try{return window.customElements.define(n,e,t),re.elements[n]=e,!0}catch(e){return window.console.error(`Error creating Custom Element: ${n} - ${e.message}`,e.trace),!1}}),re.setup=function(e){if(HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll,re.config=Object.assign({baseUrl:"",useShadowRoot:!0},e),"string"!=typeof re.config.baseUrl)throw Error("baseUrl should be a string");re.Event.add("input"),re.Event.add("change"),re.Event.addListener("input","document",re.twoWayBind),re.Event.addListener("change","document",re.twoWayBind)},re.load=function(e,{url:t,js:n=!0}={}){if(window.customElements.get(e))return Promise.resolve(window.console.warn(`Error loading Element: ${e} - Custom Element with this name is already defined.`));let r=new re.Loader(e,t);const i=customElements.whenDefined(e);return re.loadingElements.push(i),r.executeScripts(n).then(()=>{window.customElements.get(e)||(window.console.warn(`Executing '${e}' file didn't register the element. Ignore if you are registering element in a promise or async function.`),re.loadingElements.splice(re.loadingElements.indexOf(i),1))}).catch(e=>{throw re.loadingElements.splice(re.loadingElements.indexOf(i),1),e})},re.loading=(()=>Promise.all(re.loadingElements)),re});
/*! (c) @aadityataparia */
//# sourceMappingURL=sifrr.dom.min.js.map
