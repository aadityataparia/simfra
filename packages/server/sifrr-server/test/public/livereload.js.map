{"version":3,"file":"livereload.js","sources":["../../src/server/livereloadjs.js","livesrc.js"],"sourcesContent":["module.exports = path => {\n  let ws,\n    ttr = 500,\n    timeout;\n\n  function newWsConnection() {\n    ws = new WebSocket(path);\n    ws.onopen = function() {\n      ttr = 500;\n      checkMessage();\n      console.log('watching for file changes through sifrr-server livereload mode.');\n    };\n    ws.onmessage = function(event) {\n      if (JSON.parse(event.data)) {\n        console.log('Files changed, refreshing page.');\n        location.reload();\n      }\n    };\n    ws.onerror = e => {\n      console.error('Webosocket error: ', e);\n      console.log('Retrying after ', ttr / 4, 'ms');\n      ttr *= 4;\n    };\n    ws.onclose = e => {\n      console.error(`Webosocket closed with code ${e.code} error ${e.message}`);\n    };\n  }\n\n  function checkMessage() {\n    if (!ws) return;\n    if (ws.readyState === WebSocket.OPEN) ws.send('');\n    else if (ws.readyState === WebSocket.CLOSED) newWsConnection();\n\n    if (timeout) clearTimeout(timeout);\n    timeout = setTimeout(checkMessage, ttr);\n  }\n\n  newWsConnection();\n  setTimeout(checkMessage, ttr);\n};\n","import jsCode from '../../src/server/livereloadjs';\n\nconst loc = window.location;\nlet uri;\nif (loc.protocol === 'https:') {\n  uri = 'wss:';\n} else {\n  uri = 'ws:';\n}\nuri += '//' + loc.host + '/livereload';\njsCode(uri);\n"],"names":["module","path","ws","ttr","timeout","newWsConnection","WebSocket","onopen","checkMessage","console","log","onmessage","event","JSON","parse","data","location","reload","onerror","e","error","onclose","code","message","readyState","OPEN","send","CLOSED","clearTimeout","setTimeout","loc","window","uri","protocol","host","jsCode"],"mappings":";;;EAAAA,gBAAA,GAAiBC,IAAI,IAAI;QACnBC,EAAJ;QACEC,GAAG,GAAG,GADR;QAEEC,OAFF;aAISC,eAAT,GAA2B;MACzBH,EAAE,GAAG,IAAII,SAAJ,CAAcL,IAAd,CAAL;MACAC,EAAE,CAACK,MAAH,GAAY,YAAW;QACrBJ,GAAG,GAAG,GAAN;QACAK,YAAY;QACZC,OAAO,CAACC,GAAR,CAAY,iEAAZ;OAHF;MAKAR,EAAE,CAACS,SAAH,GAAe,UAASC,KAAT,EAAgB;YACzBC,IAAI,CAACC,KAAL,CAAWF,KAAK,CAACG,IAAjB,CAAJ,EAA4B;UAC1BN,OAAO,CAACC,GAAR,CAAY,iCAAZ;UACAM,QAAQ,CAACC,MAAT;;OAHJ;MAMAf,EAAE,CAACgB,OAAH,GAAaC,CAAC,IAAI;QAChBV,OAAO,CAACW,KAAR,CAAc,oBAAd,EAAoCD,CAApC;QACAV,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BP,GAAG,GAAG,CAArC,EAAwC,IAAxC;QACAA,GAAG,IAAI,CAAP;OAHF;MAKAD,EAAE,CAACmB,OAAH,GAAaF,CAAC,IAAI;QAChBV,OAAO,CAACW,KAAR,uCAA6CD,CAAC,CAACG,IAA/C,oBAA6DH,CAAC,CAACI,OAA/D;OADF;;aAKOf,YAAT,GAAwB;UAClB,CAACN,EAAL,EAAS;UACLA,EAAE,CAACsB,UAAH,KAAkBlB,SAAS,CAACmB,IAAhC,EAAsCvB,EAAE,CAACwB,IAAH,CAAQ,EAAR,EAAtC,KACK,IAAIxB,EAAE,CAACsB,UAAH,KAAkBlB,SAAS,CAACqB,MAAhC,EAAwCtB,eAAe;UAExDD,OAAJ,EAAawB,YAAY,CAACxB,OAAD,CAAZ;MACbA,OAAO,GAAGyB,UAAU,CAACrB,YAAD,EAAeL,GAAf,CAApB;;IAGFE,eAAe;IACfwB,UAAU,CAACrB,YAAD,EAAeL,GAAf,CAAV;GAtCF;;ECEA,IAAM2B,GAAG,GAAGC,MAAM,CAACf,QAAnB;EACA,IAAIgB,GAAJ;EACA,IAAIF,GAAG,CAACG,QAAJ,KAAiB,QAArB,EAA+B;EAC7BD,EAAAA,GAAG,GAAG,MAAN;EACD,CAFD,MAEO;EACLA,EAAAA,GAAG,GAAG,KAAN;EACD;EACDA,GAAG,IAAI,OAAOF,GAAG,CAACI,IAAX,GAAkB,aAAzB;AACAC,cAAM,CAACH,GAAD,CAAN;;;;"}