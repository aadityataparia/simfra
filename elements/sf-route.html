<template>
  <style>
    :host {
      display: none;
    }
    :host.active {
      display: block;
    }
  </style>
  <slot></slot>
</template>
<script>
  SF.observedAttributes['sf-route'] = ['data-route'];
  SF.attributeChangedCallback["sf-route"] = function(el, attrName, oldVal, newVal) {
    let path = SF.getRoutes(window.location.pathname);
    if (attrName == 'data-route') {
      let route = SF.getRoutes(el.dataset.route);
      let data = {};
      makeRouteInactive(el);
      for (const [i, r] of route.entries()) {
        if (r == '..') {
          makeRouteActive(el, data);
          addClass(el, 'active');
          return;
        } else if (typeof path[i] == 'undefined') {
          removeClass(el, 'active');
          makeRouteInactive(el);
          return;
        } else if (r == path[i] || r == '*') {
          addClass(el, 'active');
          continue;
        } else if (r[0] == ':') {
          data[r.substr(1)] = path[i];
          addClass(el, 'active');
          continue;
        } else {
          removeClass(el, 'active');
          makeRouteInactive(el);
          return
        }
      }
      makeRouteActive(el, data);
      addClass(el, 'active');
    }
  }

  function makeRouteActive(el, data) {
    el.innerHTML = SF.replaceHTML(el.dataset.originalSlotHtml, data, '#{route');
  }

  function makeRouteInactive(el) {
    el.dataset.originalSlotHtml = el.innerHTML;
    el.innerHTML = '';
  }
</script>